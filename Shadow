-- 获取服务
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

-- 获取当前玩家
local localPlayer = Players.LocalPlayer
local char = localPlayer.Character or localPlayer.CharacterAdded:Wait()

-- 获取目标玩家
local targetPlayer = Players:FindFirstChild("yaoshen21")

-- 如果目标玩家存在且有角色
if targetPlayer and targetPlayer.Character then
    local targetChar = targetPlayer.Character
    local targetHumanoidRootPart = targetChar:WaitForChild("HumanoidRootPart")
    local localHumanoidRootPart = char:WaitForChild("HumanoidRootPart")
    
    -- 禁用 Humanoid 的物理状态干扰
    local humanoid = char:WaitForChild("Humanoid")
    humanoid.PlatformStand = true  -- 禁止角色受物理引擎干扰

    -- 创建 BodyGyro 控制旋转
    local bodyGyro = Instance.new("BodyGyro")
    bodyGyro.MaxTorque = Vector3.new(400000, 400000, 400000)  -- 设置旋转力量，确保强度足够
    bodyGyro.P = 10000  -- 提升 P 值增加控制强度
    bodyGyro.CFrame = CFrame.Angles(math.rad(90), 0, 0)  -- 旋转90度朝上
    bodyGyro.Parent = localHumanoidRootPart

    -- 创建 BodyPosition 控制位置
    local bodyPosition = Instance.new("BodyPosition")
    bodyPosition.MaxForce = Vector3.new(400000, 400000, 400000)  -- 设置最大力，确保角色能平稳移动
    bodyPosition.P = 10000  -- 控制强度
    bodyPosition.Parent = localHumanoidRootPart

    -- 更新位置
    local function updatePosition()
        if targetHumanoidRootPart and localHumanoidRootPart then
            local targetCFrame = targetHumanoidRootPart.CFrame
            local offsetY = 5 -- 漂浮的高度

            -- 设置目标位置为目标玩家的下方
            local targetPosition = targetCFrame.Position - Vector3.new(0, offsetY, 0)
            bodyPosition.Position = targetPosition  -- 更新位置

            -- 保持面朝上的旋转
            bodyGyro.CFrame = CFrame.Angles(math.rad(90), 0, 0)
        end
    end

    -- 每帧更新位置
    RunService.RenderStepped:Connect(updatePosition)
end
