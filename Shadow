-- 获取服务
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

-- 获取当前玩家
local localPlayer = Players.LocalPlayer
local char = localPlayer.Character or localPlayer.CharacterAdded:Wait()

-- 获取目标玩家
local targetPlayer = Players:FindFirstChild("TargetPlayerName")

-- 如果目标玩家存在且有角色
if targetPlayer and targetPlayer.Character then
    local targetChar = targetPlayer.Character
    local targetHumanoidRootPart = targetChar:WaitForChild("HumanoidRootPart")
    local localHumanoidRootPart = char:WaitForChild("HumanoidRootPart")
    
    -- 禁用 Humanoid 的物理状态干扰
    local humanoid = char:WaitForChild("Humanoid")
    humanoid.PlatformStand = true  -- 禁止角色受物理引擎干扰

    -- 创建 BodyGyro 控制旋转
    local bodyGyro = Instance.new("BodyGyro")
    bodyGyro.MaxTorque = Vector3.new(400000, 400000, 400000)  -- 设置旋转力量
    bodyGyro.P = 10000  -- 提升 P 值增加控制强度
    bodyGyro.CFrame = CFrame.Angles(math.rad(90), 0, 0)  -- 旋转90度朝上
    bodyGyro.Parent = localHumanoidRootPart

    -- 创建 BodyPosition 控制位置
    local bodyPosition = Instance.new("BodyPosition")
    bodyPosition.MaxForce = Vector3.new(400000, 400000, 400000)  -- 增加 Y 方向上的力量，允许在 Y 轴上移动
    bodyPosition.P = 10000  -- 控制强度
    bodyPosition.D = 1000   -- 添加阻尼来稳定角色漂浮效果
    bodyPosition.Position = localHumanoidRootPart.Position  -- 初始位置设为当前角色位置
    bodyPosition.Parent = localHumanoidRootPart

    -- 获取当前玩家的高度 (固定) 并加上偏移量
    local heightOffset = -5  -- 可以调整这个值让角色漂浮更低
    local fixedY = localHumanoidRootPart.Position.Y + heightOffset

    -- 更新位置
    local function updatePosition()
        if targetHumanoidRootPart and localHumanoidRootPart then
            local targetCFrame = targetHumanoidRootPart.CFrame

            -- 仅在 X 和 Z 方向跟随目标玩家的移动，并应用高度偏移
            local targetPosition = Vector3.new(targetCFrame.Position.X, fixedY, targetCFrame.Position.Z)
            bodyPosition.Position = targetPosition  -- 更新位置

            -- 保持面朝上的旋转
            bodyGyro.CFrame = CFrame.Angles(math.rad(90), 0, 0)
        end
    end

    -- 每帧更新位置
    RunService.RenderStepped:Connect(updatePosition)
end
-- 获取服务
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

-- 获取当前玩家
local localPlayer = Players.LocalPlayer
local char = localPlayer.Character or localPlayer.CharacterAdded:Wait()

-- 获取目标玩家
local targetPlayer = Players:FindFirstChild("TargetPlayerName")

-- 如果目标玩家存在且有角色
if targetPlayer and targetPlayer.Character then
    local targetChar = targetPlayer.Character
    local targetHumanoidRootPart = targetChar:WaitForChild("HumanoidRootPart")
    local localHumanoidRootPart = char:WaitForChild("HumanoidRootPart")
    
    -- 禁用 Humanoid 的物理状态干扰
    local humanoid = char:WaitForChild("Humanoid")
    humanoid.PlatformStand = true  -- 禁止角色受物理引擎干扰

    -- 创建 BodyGyro 控制旋转
    local bodyGyro = Instance.new("BodyGyro")
    bodyGyro.MaxTorque = Vector3.new(400000, 400000, 400000)  -- 设置旋转力量
    bodyGyro.P = 10000  -- 提升 P 值增加控制强度
    bodyGyro.CFrame = CFrame.Angles(math.rad(90), 0, 0)  -- 旋转90度朝上
    bodyGyro.Parent = localHumanoidRootPart

    -- 创建 BodyPosition 控制位置
    local bodyPosition = Instance.new("BodyPosition")
    bodyPosition.MaxForce = Vector3.new(400000, 400000, 400000)  -- 增加 Y 方向上的力量，允许在 Y 轴上移动
    bodyPosition.P = 10000  -- 控制强度
    bodyPosition.D = 1000   -- 添加阻尼来稳定角色漂浮效果
    bodyPosition.Position = localHumanoidRootPart.Position  -- 初始位置设为当前角色位置
    bodyPosition.Parent = localHumanoidRootPart

    -- 获取当前玩家的高度 (固定) 并加上偏移量
    local heightOffset = -5  -- 可以调整这个值让角色漂浮更低
    local fixedY = localHumanoidRootPart.Position.Y + heightOffset

    -- 更新位置
    local function updatePosition()
        if targetHumanoidRootPart and localHumanoidRootPart then
            local targetCFrame = targetHumanoidRootPart.CFrame

            -- 仅在 X 和 Z 方向跟随目标玩家的移动，并应用高度偏移
            local targetPosition = Vector3.new(targetCFrame.Position.X, fixedY, targetCFrame.Position.Z)
            bodyPosition.Position = targetPosition  -- 更新位置

            -- 保持面朝上的旋转
            bodyGyro.CFrame = CFrame.Angles(math.rad(90), 0, 0)
        end
    end

    -- 每帧更新位置
    RunService.RenderStepped:Connect(updatePosition)
end
