-- 获取服务
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

-- 获取当前玩家
local localPlayer = Players.LocalPlayer
local char = localPlayer.Character or localPlayer.CharacterAdded:Wait()

-- 获取目标玩家
local targetPlayer = Players:FindFirstChild("yaoshen21")  -- 替换 "TargetPlayerName" 为实际目标玩家名字

-- 如果目标玩家存在且有角色
if targetPlayer and targetPlayer.Character then
    local targetChar = targetPlayer.Character
    local targetHumanoidRootPart = targetChar:WaitForChild("HumanoidRootPart")
    local localHumanoidRootPart = char:WaitForChild("HumanoidRootPart")
    
    -- 禁用 Humanoid 的物理状态干扰
    local humanoid = char:WaitForChild("Humanoid")
    humanoid.PlatformStand = true  -- 禁用物理引擎干扰

    -- 锚定角色，使其不受物理引擎影响
    localHumanoidRootPart.Anchored = true  -- 这将使角色固定，不会掉下去

    -- 创建 BodyGyro 控制旋转
    local bodyGyro = Instance.new("BodyGyro")
    bodyGyro.MaxTorque = Vector3.new(400000, 400000, 400000)  -- 设置旋转力量
    bodyGyro.P = 10000  -- 提升 P 值增加控制强度
    bodyGyro.CFrame = CFrame.Angles(math.rad(90), 0, 0)  -- 旋转90度朝上
    bodyGyro.Parent = localHumanoidRootPart

    -- 设置相对于目标的偏移量
    local heightOffset = -5  -- 这里设置目标玩家下方的偏移距离，负值代表在下面

    -- 更新位置
    local function updatePosition()
        if targetHumanoidRootPart and localHumanoidRootPart then
            local targetCFrame = targetHumanoidRootPart.CFrame

            -- 仅在 X 和 Z 方向跟随目标玩家的移动，Y 高度为目标玩家的高度加偏移
            local targetPosition = Vector3.new(
                targetCFrame.Position.X, 
                targetCFrame.Position.Y + heightOffset,  -- 相对于目标的偏移
                targetCFrame.Position.Z
            )
            localHumanoidRootPart.CFrame = CFrame.new(targetPosition)  -- 设置位置

            -- 保持面朝上的旋转
            bodyGyro.CFrame = CFrame.Angles(math.rad(90), 0, 0)
        end
    end

    -- 每帧更新位置
    RunService.RenderStepped:Connect(updatePosition)
end
