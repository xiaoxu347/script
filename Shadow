-- 获取服务
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")

-- 获取当前玩家
local localPlayer = Players.LocalPlayer
local char = localPlayer.Character or localPlayer.CharacterAdded:Wait()

-- GUI 可移动功能
local function makeGuiDraggable(frame)
    local dragging = false
    local dragInput, dragStart, startPos

    local function update(input)
        local delta = input.Position - dragStart
        frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end

    frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = frame.Position

            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)

    frame.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            dragInput = input
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            update(input)
        end
    end)
end

-- 创建 ScreenGui
local screenGui = Instance.new("ScreenGui")
screenGui.Parent = localPlayer:WaitForChild("PlayerGui")

-- 创建输入框容器
local inputFrame = Instance.new("Frame")
inputFrame.Size = UDim2.new(0, 220, 0, 150)
inputFrame.Position = UDim2.new(0.5, -110, 0.4, 0)
inputFrame.BackgroundTransparency = 0.3
inputFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
inputFrame.Parent = screenGui
makeGuiDraggable(inputFrame)  -- 使 GUI 可拖动

-- 创建 TextBox 输入目标玩家名字
local inputBox = Instance.new("TextBox")
inputBox.Size = UDim2.new(0, 200, 0, 50)
inputBox.Position = UDim2.new(0, 10, 0, 10)
inputBox.PlaceholderText = "输入目标玩家名字"
inputBox.Parent = inputFrame

-- 自动联想结果的显示容器
local suggestionFrame = Instance.new("Frame")
suggestionFrame.Size = UDim2.new(0, 200, 0, 100)
suggestionFrame.Position = UDim2.new(0, 10, 0, 60)
suggestionFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
suggestionFrame.Visible = false -- 默认隐藏
suggestionFrame.Parent = inputFrame

-- 创建按钮
local followButton = Instance.new("TextButton")
followButton.Size = UDim2.new(0, 200, 0, 50)
followButton.Position = UDim2.new(0, 10, 0, 120)
followButton.Text = "开始跟随"
followButton.Parent = inputFrame

-- 刷新建议框
local function updateSuggestions(input)
    suggestionFrame:ClearAllChildren() -- 清空旧的建议

    local text = inputBox.Text:lower() -- 获取输入的文本
    if text == "" then
        suggestionFrame.Visible = false
        return
    end

    local matches = {}
    for _, player in pairs(Players:GetPlayers()) do
        if player.Name:lower():sub(1, #text) == text then
            table.insert(matches, player.Name)
        end
    end

    if #matches > 0 then
        suggestionFrame.Visible = true
        for i, match in ipairs(matches) do
            local suggestion = Instance.new("TextButton")
            suggestion.Size = UDim2.new(1, 0, 0, 30)
            suggestion.Text = match
            suggestion.Parent = suggestionFrame

            -- 点击建议时，将文本放入输入框
            suggestion.MouseButton1Click:Connect(function()
                inputBox.Text = match
                suggestionFrame.Visible = false
            end)
        end
    else
        suggestionFrame.Visible = false
    end
end

-- 每次用户输入时更新建议
inputBox:GetPropertyChangedSignal("Text"):Connect(function()
    updateSuggestions(inputBox.Text)
end)

-- 当按钮被点击时执行的操作
followButton.MouseButton1Click:Connect(function()
    local targetPlayerName = inputBox.Text  -- 获取输入框中的名字
    local targetPlayer = Players:FindFirstChild(targetPlayerName)

    if targetPlayer then
        print("找到玩家: " .. targetPlayerName)

        -- 如果目标玩家已经存在角色，则立即开始跟随
        if targetPlayer.Character then
            followTarget(targetPlayer.Character)
        end
    else
        print("未找到玩家: " .. targetPlayerName)
    end
end)

-- 其他代码保持不变
