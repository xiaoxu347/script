-- 获取服务
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

-- 获取当前玩家
local localPlayer = Players.LocalPlayer
local char = localPlayer.Character or localPlayer.CharacterAdded:Wait()

-- 获取目标玩家
local targetPlayer = Players:FindFirstChild("TargetPlayerName")

-- 如果目标玩家存在且有角色
if targetPlayer and targetPlayer.Character then
    local targetChar = targetPlayer.Character
    local targetHumanoidRootPart = targetChar:WaitForChild("HumanoidRootPart")
    local localHumanoidRootPart = char:WaitForChild("HumanoidRootPart")
    
    -- 禁用 Humanoid 的物理状态干扰
    local humanoid = char:WaitForChild("Humanoid")
    humanoid.PlatformStand = true  -- 禁止角色受物理引擎干扰

    -- 创建 BodyGyro 控制旋转
    local bodyGyro = Instance.new("BodyGyro")
    bodyGyro.MaxTorque = Vector3.new(400000, 400000, 400000)  -- 设置旋转力量
    bodyGyro.P = 10000  -- 提升 P 值增加控制强度
    bodyGyro.CFrame = CFrame.Angles(math.rad(90), 0, 0)  -- 旋转90度朝上
    bodyGyro.Parent = localHumanoidRootPart

    -- 创建 BodyPosition 控制位置
    local bodyPosition = Instance.new("BodyPosition")
    bodyPosition.MaxForce = Vector3.new(400000, 0, 400000)  -- 只允许在X和Z方向上移动
    bodyPosition.P = 10000  -- 控制强度
    bodyPosition.Position = localHumanoidRootPart.Position  -- 初始位置设为当前角色位置
    bodyPosition.Parent = localHumanoidRootPart

    -- 设置自定义的初始高度
    local desiredYHeight = 10  -- 你可以把它设置为你想要的高度

    -- 更新位置
    local function updatePosition()
        if targetHumanoidRootPart and localHumanoidRootPart then
            local targetCFrame = targetHumanoidRootPart.CFrame

            -- 仅在 X 和 Z 方向跟随目标玩家的移动，Y 高度为自定义高度
            local targetPosition = Vector3.new(targetCFrame.Position.X, desiredYHeight, targetCFrame.Position.Z)
            bodyPosition.Position = targetPosition  -- 更新位置

            -- 保持面朝上的旋转
            bodyGyro.CFrame = CFrame.Angles(math.rad(90), 0, 0)
        end
    end

    -- 每帧更新位置
    RunService.RenderStepped:Connect(updatePosition)
end
